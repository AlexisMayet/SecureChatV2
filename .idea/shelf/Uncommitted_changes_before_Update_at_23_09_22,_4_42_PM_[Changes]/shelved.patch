Index: .project
===================================================================
diff --git a/.project b/.project
deleted file mode 100644
--- a/.project	(revision e4db8dfbf383479a9745cd86c2d7da4d402cf996)
+++ /dev/null	(revision e4db8dfbf383479a9745cd86c2d7da4d402cf996)
@@ -1,17 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<projectDescription>
-	<name>SecureChatV2</name>
-	<comment></comment>
-	<projects>
-	</projects>
-	<buildSpec>
-		<buildCommand>
-			<name>org.eclipse.jdt.core.javabuilder</name>
-			<arguments>
-			</arguments>
-		</buildCommand>
-	</buildSpec>
-	<natures>
-		<nature>org.eclipse.jdt.core.javanature</nature>
-	</natures>
-</projectDescription>
Index: .classpath
===================================================================
diff --git a/.classpath b/.classpath
deleted file mode 100644
--- a/.classpath	(revision e4db8dfbf383479a9745cd86c2d7da4d402cf996)
+++ /dev/null	(revision e4db8dfbf383479a9745cd86c2d7da4d402cf996)
@@ -1,11 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<classpath>
-	<classpathentry kind="src" path="src"/>
-	<classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-17">
-		<attributes>
-			<attribute name="module" value="true"/>
-		</attributes>
-	</classpathentry>
-	<classpathentry kind="lib" path="C:/Users/RubÃ©n/Dropbox/-= Publico =-/CSecurity/gson-2.8.2.jar"/>
-	<classpathentry kind="output" path="bin"/>
-</classpath>
Index: src/User.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/User.java b/src/User.java
new file mode 100644
--- /dev/null	(date 1663801146249)
+++ b/src/User.java	(date 1663801146249)
@@ -0,0 +1,23 @@
+public class User {
+    private String id;
+    private String password;
+    private String key;
+
+    public User(String id, String password, String key){
+        this.id=id;
+        this.password=password;
+        this.key=key;
+    }
+
+    public String getId() {
+        return id;
+    }
+
+    public String getPassword() {
+        return password;
+    }
+
+    public String getKey() {
+        return key;
+    }
+}
Index: client.json
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/client.json b/resources/client.json
rename from client.json
rename to resources/client.json
--- a/client.json	(revision e4db8dfbf383479a9745cd86c2d7da4d402cf996)
+++ b/resources/client.json	(date 1663943910042)
@@ -1,5 +1,5 @@
 {
-	"id": "Imanol",
+	"id": "Imanoleded",
  	"password": "Imagol",
  	"server":
  	{
Index: src/Client.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import java.io.*;\nimport java.net.Socket;\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.StringTokenizer;\n\nimport com.google.gson.JsonArray;\nimport com.google.gson.JsonElement;\nimport com.google.gson.JsonObject;\nimport com.google.gson.JsonParseException;\nimport com.google.gson.JsonParser;\n\npublic class Client implements Serializable {\n\n\t/**\n\t* \n\t*/\n\tprivate static final long serialVersionUID = 1L;\n\tprivate String username;\n\tprivate String password;\n\tprivate int delay;\n\tprivate String actions;\n\n\t@Override\n\tpublic String toString() {\n\t\treturn \"Client [username=\" + username + \", password=\" + password + \", delay=\" + delay + \", actions=\" + actions\n\t\t\t\t+ \"]\";\n\t}\n\n\tpublic Client(String username, String password, int delay, String actions) {\n\n\t\tthis.username = username;\n\t\tthis.password = password;\n\t\tthis.delay = delay;\n\t\tthis.actions = actions;\n\t}\n\n\tpublic void closeEverything(Socket socket, BufferedReader bufferedReader, BufferedWriter bufferedWriter) {\n\n\t\ttry {\n\t\t\tif (bufferedReader != null) {\n\t\t\t\tbufferedReader.close();\n\t\t\t}\n\n\t\t\tif (bufferedWriter != null) {\n\t\t\t\tbufferedWriter.close();\n\t\t\t}\n\n\t\t\tif (socket != null) {\n\t\t\t\tsocket.close();\n\t\t\t}\n\t\t} catch (IOException e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t}\n\n\tpublic static void main(String[] args) throws IOException {\n\n\t\t// Previous\n\t\t// -------------------------------------------------\n\t\t// Socket socket = new Socket(\"localhost\", 1234);\n\t\t// Client client = new Client(socket, \"Pepe\");\n\t\t// -------------------------------------------------\n\n\t\tString filename = args[0];\n\n\t\tJsonParser jsonParser = new JsonParser();\n\n\t\ttry (FileReader reader = new FileReader(filename)) {\n\n\t\t\tJsonObject clienteObjeto = (JsonObject) jsonParser.parse(reader);\n\n\t\t\t// data\n\t\t\tString id = clienteObjeto.get(\"id\").getAsString();\n\t\t\t// data\n\t\t\tString pass = clienteObjeto.get(\"password\").getAsString();\n\n\t\t\tJsonObject server = clienteObjeto.getAsJsonObject(\"server\");\n\n\t\t\t// data\n\t\t\tString ipServer = server.get(\"ip\").getAsString();\n\t\t\t// data\n\t\t\tint portServer = Integer.parseInt(server.get(\"port\").getAsString());\n\n\t\t\tJsonObject jsoActions = clienteObjeto.getAsJsonObject(\"actions\");\n\n\t\t\t// data\n\t\t\tString sDelay = jsoActions.get(\"delay\").getAsString();\n\n\t\t\tint delay = Integer.parseInt(sDelay);\n\n\t\t\t// data\n\t\t\tJsonArray jsaSteps = jsoActions.getAsJsonArray(\"steps\");\n\n\t\t\tString actions = \"\";\n\n\t\t\tfor (JsonElement e : jsaSteps) {\n\n\t\t\t\tString opAmount = e.getAsString();\n\n\t\t\t\tStringTokenizer st = new StringTokenizer(opAmount, \" \");\n\n\t\t\t\tString op = st.nextToken();\n\n\t\t\t\tint amount = Integer.parseInt(st.nextToken());\n\n\t\t\t\tString a = op + \" \" + amount;\n\n\t\t\t\tactions += a + \",\";\n\t\t\t}\n\n\t\t\t// donde dice localhost es la IP: localhost es 127.0.0.1 y 1234 es el port\n\t\t\tSocket socket = new Socket(ipServer, portServer);\n\t\t\t// Para no usar metodos publicos al crear el cliente, se crea con toda la info\n\t\t\t// del json\n\t\t\tClient client = new Client(id, pass, delay, actions);\n\n\t\t\t// Grabar un objeto en el socket\n\t\t\tOutputStream outputStream = socket.getOutputStream();\n\t\t\tObjectOutputStream objectOutputStream = new ObjectOutputStream(outputStream);\n\t\t\tobjectOutputStream.writeObject(client);\n\n\t\t\t// client.listenForMessage();\n\t\t\t// client.sendMessage();\n\n\t\t} catch (FileNotFoundException e) {\n\t\t\te.printStackTrace();\n\t\t} catch (IOException e) {\n\t\t\te.printStackTrace();\n\t\t} catch (JsonParseException e) {\n\t\t\te.printStackTrace();\n\t\t}\n\n\t}\n\n\tpublic String getID() {\n\n\t\treturn username;\n\t}\n\n}\n/*\n * \n * public static void main(String[] args) throws IOException { // need host and\n * port, we want to connect to the ServerSocket at port 7777 Socket socket = new\n * Socket(\"localhost\", 7777); System.out.println(\"Connected!\");\n * \n * // get the output stream from the socket. OutputStream outputStream =\n * socket.getOutputStream(); // create an object output stream from the output\n * stream so we can send an // object through it ObjectOutputStream\n * objectOutputStream = new ObjectOutputStream(outputStream);\n * \n * // make a bunch of messages to send. List<Message> messages = new\n * ArrayList<>(); messages.add(new Message(\"Hello from the other side!\"));\n * messages.add(new Message(\"How are you doing?\")); messages.add(new\n * Message(\"What time is it?\")); messages.add(new Message(\"Hi hi hi hi.\"));\n * \n * System.out.println(\"Sending messages to the ServerSocket\");\n * objectOutputStream.writeObject(messages);\n * \n * System.out.println(\"Closing socket and terminating program.\");\n * socket.close(); }\n * \n * }\n */\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/Client.java b/src/Client.java
--- a/src/Client.java	(revision e4db8dfbf383479a9745cd86c2d7da4d402cf996)
+++ b/src/Client.java	(date 1663943705394)
@@ -1,8 +1,6 @@
 import java.io.*;
 import java.net.Socket;
-import java.util.ArrayList;
-import java.util.List;
-import java.util.StringTokenizer;
+import java.util.*;
 
 import com.google.gson.JsonArray;
 import com.google.gson.JsonElement;
@@ -10,6 +8,9 @@
 import com.google.gson.JsonParseException;
 import com.google.gson.JsonParser;
 
+import javax.swing.*;
+import javax.swing.filechooser.FileNameExtensionFilter;
+
 public class Client implements Serializable {
 
 	/**
@@ -54,6 +55,16 @@
 		}
 	}
 
+	public static String getFile()
+	{
+		JFrame chooser_f = new JFrame();
+		JFileChooser chooser = new JFileChooser();
+		FileNameExtensionFilter filter = new FileNameExtensionFilter("JSON files", "json", "JSON");
+		chooser.setFileFilter(filter);
+		chooser.showOpenDialog(chooser_f);
+		return chooser.getSelectedFile().getPath();
+	}
+
 	public static void main(String[] args) throws IOException {
 
 		// Previous
@@ -62,7 +73,8 @@
 		// Client client = new Client(socket, "Pepe");
 		// -------------------------------------------------
 
-		String filename = args[0];
+
+		String filename = getFile();
 
 		JsonParser jsonParser = new JsonParser();
 
@@ -92,7 +104,7 @@
 			// data
 			JsonArray jsaSteps = jsoActions.getAsJsonArray("steps");
 
-			String actions = "";
+			StringBuilder actions = new StringBuilder();
 
 			for (JsonElement e : jsaSteps) {
 
@@ -106,28 +118,36 @@
 
 				String a = op + " " + amount;
 
-				actions += a + ",";
+				actions.append(a).append(",");
 			}
 
-			// donde dice localhost es la IP: localhost es 127.0.0.1 y 1234 es el port
 			Socket socket = new Socket(ipServer, portServer);
-			// Para no usar metodos publicos al crear el cliente, se crea con toda la info
-			// del json
-			Client client = new Client(id, pass, delay, actions);
 
-			// Grabar un objeto en el socket
+			Client client = new Client(id, pass, delay, actions.toString());
+
 			OutputStream outputStream = socket.getOutputStream();
 			ObjectOutputStream objectOutputStream = new ObjectOutputStream(outputStream);
 			objectOutputStream.writeObject(client);
 
-			// client.listenForMessage();
-			// client.sendMessage();
+
+
+			InputStream inputStream = socket.getInputStream();
+			ObjectInputStream objectInputStream = new ObjectInputStream(inputStream);
+
+			Output outA = (Output) objectInputStream.readObject();
+			System.out.println(outA.getStatus_description());
+			if(outA.getStatus()==Status.OFFLINE)
+				System.exit(0);
+
+			objectOutputStream.writeObject(twoFac());
 
-		} catch (FileNotFoundException e) {
-			e.printStackTrace();
-		} catch (IOException e) {
-			e.printStackTrace();
-		} catch (JsonParseException e) {
+			Output outB = (Output) objectInputStream.readObject();
+			System.out.println(outB.getStatus_description());
+			if(outB.getStatus()==Status.OFFLINE)
+				System.exit(0);
+
+
+		} catch (IOException | JsonParseException | ClassNotFoundException e) {
 			e.printStackTrace();
 		}
 
@@ -138,6 +158,22 @@
 		return username;
 	}
 
+	public String getPassword() {
+		return password;
+	}
+
+	public static String twoFac() {
+		Scanner scanner = new Scanner(System.in);
+		String s = "";
+		System.out.print("Please input your two factor authentication code:\t");
+		while (scanner.hasNextLine()){
+			s = scanner.nextLine();
+			if(!Objects.equals(s, ""))
+				break;
+		}
+
+		return s;
+	}
 }
 /*
  * 
Index: SecureChatV2.iml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<module type=\"JAVA_MODULE\" version=\"4\">\n  <component name=\"NewModuleRootManager\" inherit-compiler-output=\"true\">\n    <exclude-output />\n    <content url=\"file://$MODULE_DIR$\">\n      <sourceFolder url=\"file://$MODULE_DIR$/src\" isTestSource=\"false\" />\n    </content>\n    <orderEntry type=\"inheritedJdk\" />\n    <orderEntry type=\"sourceFolder\" forTests=\"false\" />\n    <orderEntry type=\"library\" name=\"google.code.gson\" level=\"project\" />\n  </component>\n</module>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/SecureChatV2.iml b/SecureChatV2.iml
--- a/SecureChatV2.iml	(revision e4db8dfbf383479a9745cd86c2d7da4d402cf996)
+++ b/SecureChatV2.iml	(date 1663940156415)
@@ -3,10 +3,14 @@
   <component name="NewModuleRootManager" inherit-compiler-output="true">
     <exclude-output />
     <content url="file://$MODULE_DIR$">
+      <sourceFolder url="file://$MODULE_DIR$/resources" type="java-resource" />
       <sourceFolder url="file://$MODULE_DIR$/src" isTestSource="false" />
     </content>
     <orderEntry type="inheritedJdk" />
     <orderEntry type="sourceFolder" forTests="false" />
     <orderEntry type="library" name="google.code.gson" level="project" />
+    <orderEntry type="library" name="de.taimos.totp" level="project" />
+    <orderEntry type="library" name="commons.codec" level="project" />
+    <orderEntry type="library" name="google.zxing.javase" level="project" />
   </component>
 </module>
\ No newline at end of file
Index: .idea/libraries/commons_codec.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/libraries/commons_codec.xml b/.idea/libraries/commons_codec.xml
new file mode 100644
--- /dev/null	(date 1663940156421)
+++ b/.idea/libraries/commons_codec.xml	(date 1663940156421)
@@ -0,0 +1,10 @@
+<component name="libraryTable">
+  <library name="commons.codec" type="repository">
+    <properties maven-id="commons-codec:commons-codec:1.10" />
+    <CLASSES>
+      <root url="jar://$PROJECT_DIR$/lib/commons-codec-1.10.jar!/" />
+    </CLASSES>
+    <JAVADOC />
+    <SOURCES />
+  </library>
+</component>
\ No newline at end of file
Index: src/Server.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import java.io.*;\nimport java.net.ServerSocket;\nimport java.net.Socket;\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.LinkedList;\nimport java.util.List;\n\npublic class Server {\n\n\tprivate static HashMap<String, Client> clients = new HashMap<String, Client>(13);\n\t\n\t//private static LinkedList<ClientThread> threads = new LinkedList<>();\n\t\n\tpublic static void main(String[] args) throws IOException, ClassNotFoundException {\n\n\t\tServerSocket ss = new ServerSocket(1234);\n\n\t\tSystem.out.println(\"ServerSocket awaiting connections...\");\n\t\t\t\n\t\twhile( !ss.isClosed() )\n\t\t{\n\t\t\tSocket socket = ss.accept();\n\t\t\n\t\t\tSystem.out.println(\"Connection from \" + socket + \"!\");\n\n\t\t\tInputStream inputStream = socket.getInputStream();\n\t\t\tObjectInputStream objectInputStream = new ObjectInputStream(inputStream);\n\n\t\t\tClient client = (Client) objectInputStream.readObject();\n\t\t\t\t\t\t\n\t\t\tif( !clients.containsKey(client.getID() ) )\n\t\t\t{\n\t\t\t\tclients.put( client.getID(), client);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tSystem.err.println(\"That client is on the server already.\");\n\t\t\t}\n\n\t\t\tSystem.out.println(\"Clientes: \" + clients.size() );\n\t\t\t\n\t\t\tfor( Client c : clients.values() )\n\t\t\t{\n\t\t\t\tSystem.out.println( c );\n\t\t\t}\n\t\t}\n\n\t\t// System.out.println(\"Closing sockets.\");\n\t\t// ss.close();\n\t\t// socket.close();\n\t}\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/Server.java b/src/Server.java
--- a/src/Server.java	(revision e4db8dfbf383479a9745cd86c2d7da4d402cf996)
+++ b/src/Server.java	(date 1663943546539)
@@ -1,48 +1,144 @@
+import com.google.gson.JsonArray;
+import com.google.gson.JsonObject;
+import com.google.gson.JsonParser;
+import de.taimos.totp.TOTP;
+import org.apache.commons.codec.binary.Base32;
+import org.apache.commons.codec.binary.Hex;
+
 import java.io.*;
 import java.net.ServerSocket;
 import java.net.Socket;
-import java.util.ArrayList;
-import java.util.HashMap;
-import java.util.LinkedList;
-import java.util.List;
+import java.util.*;
 
 public class Server {
 
 	private static HashMap<String, Client> clients = new HashMap<String, Client>(13);
 	
 	//private static LinkedList<ClientThread> threads = new LinkedList<>();
+
+	private static ArrayList<User> users = new ArrayList<>();
+
+	public static void generate_users() throws FileNotFoundException
+	{
+		JsonParser jsonParser = new JsonParser();
+		FileReader reader =  new FileReader("resources/users.json");
+		JsonArray users_object = (JsonArray) jsonParser.parse(reader);
+
+		int users_s = users_object.size();
+
+		for (int i = 0; i < users_s; i++) {
+			User user = new User(
+					users_object.get(i).getAsJsonObject().get("id").getAsString(),
+					users_object.get(i).getAsJsonObject().get("password").getAsString(),
+					users_object.get(i).getAsJsonObject().get("secret-key").getAsString());
+			users.add(user);
+		}
+
+	}
+
+	private static String generateNum(Client client) {
+		String secretKey = "";
+		for(User u : users)
+		{
+			if(Objects.equals(u.getId(), client.getID()))
+				secretKey = u.getKey();
+		}
+		String lastCode = null;
+		while (true) {
+			Base32 base32 = new Base32();
+			byte[] bytes = base32.decode(secretKey);
+			String hexKey = Hex.encodeHexString(bytes);
+			String code = TOTP.getOTP(hexKey);
+			if (!code.equals(lastCode)) {
+				System.out.println("CODE--- " + code);
+				return code;
+			}
+			lastCode = code;
+			try {
+				Thread.sleep(1000);
+			} catch (InterruptedException e) {};
+		}
+	}
+
+	private static boolean check_id(Client client)
+	{
+		boolean found = false;
+		for (User u : users)
+		{
+			if(Objects.equals(client.getID(), u.getId()))
+				found = true;
+
+		}
+		return found;
+	}
+
+	private static boolean check_password(Client client)
+	{
+		User user = null;
+		for (User u : users)
+			if(Objects.equals(u.getId(), client.getID()))
+				user = u;
+
+		return Objects.equals(user.getPassword(), client.getPassword());
+	}
 	
 	public static void main(String[] args) throws IOException, ClassNotFoundException {
 
+		try {
+			generate_users();
+		}catch (FileNotFoundException e) {
+			System.out.println("Failed to read users.\nShutting down server.");
+			System.exit(0);
+		}
+
 		ServerSocket ss = new ServerSocket(1234);
 
 		System.out.println("ServerSocket awaiting connections...");
 			
-		while( !ss.isClosed() )
+		while(true)
 		{
 			Socket socket = ss.accept();
 		
 			System.out.println("Connection from " + socket + "!");
 
 			InputStream inputStream = socket.getInputStream();
+			OutputStream outputStream = socket.getOutputStream();
 			ObjectInputStream objectInputStream = new ObjectInputStream(inputStream);
+			ObjectOutputStream objectOutputStream = new ObjectOutputStream(outputStream);
 
 			Client client = (Client) objectInputStream.readObject();
-						
-			if( !clients.containsKey(client.getID() ) )
+
+			if(!check_id(client))
+			{
+				objectOutputStream.writeObject(new Output(Status.OFFLINE,"User not found."));
+				System.out.println("Closing socket for user: " + socket + "\nReason: User not found.");
+
+			}
+			else if(!check_password(client))
 			{
-				clients.put( client.getID(), client);
+				objectOutputStream.writeObject(new Output(Status.OFFLINE,"Password do not match."));
+				System.out.println("Closing socket for user: " + socket + "\nReason: Password do not match.");
 			}
-			else
-			{
-				System.err.println("That client is on the server already.");
-			}
+			else {
+				objectOutputStream.writeObject(new Output(Status.IDLE,"Correct password."));
+				if(Objects.equals(objectInputStream.readObject(),generateNum(client)))
+					objectOutputStream.writeObject(new Output(Status.IDLE,"Login successful.\nProceed with the action."));
+				else
+					objectOutputStream.writeObject(new Output(Status.OFFLINE,"Login unsuccessful."));
+
+
+
+				if (!clients.containsKey(client.getID())) {
+					clients.put(client.getID(), client);
+				} else {
+					System.err.println("That client is on the server already.");
+				}
 
-			System.out.println("Clientes: " + clients.size() );
-			
-			for( Client c : clients.values() )
-			{
-				System.out.println( c );
+				System.out.println("Clientes: " + clients.size());
+
+				for (Client c : clients.values()) {
+					System.out.println(c);
+				}
 			}
 		}
 
Index: src/Status.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/Status.java b/src/Status.java
new file mode 100644
--- /dev/null	(date 1663943546534)
+++ b/src/Status.java	(date 1663943546534)
@@ -0,0 +1,3 @@
+public enum Status {
+    IDLE,OFFLINE
+}
Index: src/Output.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/Output.java b/src/Output.java
new file mode 100644
--- /dev/null	(date 1663943831346)
+++ b/src/Output.java	(date 1663943831346)
@@ -0,0 +1,19 @@
+import java.io.Serializable;
+
+public class Output implements Serializable {
+    private String status_description;
+    private Status status;
+
+    public Output(Status status, String status_description){
+        this.status=status;
+        this.status_description=status_description;
+    }
+
+    public Status getStatus() {
+        return status;
+    }
+
+    public String getStatus_description() {
+        return status_description;
+    }
+}
Index: .idea/libraries/de_taimos_totp.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/libraries/de_taimos_totp.xml b/.idea/libraries/de_taimos_totp.xml
new file mode 100644
--- /dev/null	(date 1663940156424)
+++ b/.idea/libraries/de_taimos_totp.xml	(date 1663940156424)
@@ -0,0 +1,11 @@
+<component name="libraryTable">
+  <library name="de.taimos.totp" type="repository">
+    <properties maven-id="de.taimos:totp:1.0" />
+    <CLASSES>
+      <root url="jar://$MAVEN_REPOSITORY$/de/taimos/totp/1.0/totp-1.0.jar!/" />
+      <root url="jar://$MAVEN_REPOSITORY$/commons-codec/commons-codec/1.8/commons-codec-1.8.jar!/" />
+    </CLASSES>
+    <JAVADOC />
+    <SOURCES />
+  </library>
+</component>
\ No newline at end of file
Index: client2.json
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/client2.json b/resources/client2.json
rename from client2.json
rename to resources/client2.json
--- a/client2.json	(revision e4db8dfbf383479a9745cd86c2d7da4d402cf996)
+++ b/resources/client2.json	(date 1663943910040)
@@ -1,6 +1,6 @@
 {
 	"id": "Ruben",
- 	"password": "Rugen",
+ 	"password": "Rugenwr",
  	"server":
  	{
  		"ip": "127.0.0.1",
Index: .idea/libraries/google_zxing_javase.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/libraries/google_zxing_javase.xml b/.idea/libraries/google_zxing_javase.xml
new file mode 100644
--- /dev/null	(date 1663940156428)
+++ b/.idea/libraries/google_zxing_javase.xml	(date 1663940156428)
@@ -0,0 +1,12 @@
+<component name="libraryTable">
+  <library name="google.zxing.javase" type="repository">
+    <properties maven-id="com.google.zxing:javase:3.2.1" />
+    <CLASSES>
+      <root url="jar://$PROJECT_DIR$/lib/javase-3.2.1.jar!/" />
+      <root url="jar://$PROJECT_DIR$/lib/core-3.2.1.jar!/" />
+      <root url="jar://$PROJECT_DIR$/lib/jcommander-1.48.jar!/" />
+    </CLASSES>
+    <JAVADOC />
+    <SOURCES />
+  </library>
+</component>
\ No newline at end of file
Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"AutoImportSettings\">\n    <option name=\"autoReloadType\" value=\"SELECTIVE\" />\n  </component>\n  <component name=\"ChangeListManager\">\n    <list default=\"true\" id=\"56f3a841-0724-4915-84a5-723e5a82068c\" name=\"Changes\" comment=\"\" />\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\n  </component>\n  <component name=\"MarkdownSettingsMigration\">\n    <option name=\"stateVersion\" value=\"1\" />\n  </component>\n  <component name=\"ProjectId\" id=\"2F5LrsMlN6fCPAEeCpEu8vXPM7M\" />\n  <component name=\"ProjectViewState\">\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\n    <option name=\"showLibraryContents\" value=\"true\" />\n  </component>\n  <component name=\"PropertiesComponent\"><![CDATA[{\n  \"keyToString\": {\n    \"Downloaded.Files.Path.Enabled\": \"true\",\n    \"Repository.Attach.Annotations\": \"false\",\n    \"Repository.Attach.JavaDocs\": \"false\",\n    \"Repository.Attach.Sources\": \"false\",\n    \"RunOnceActivity.OpenProjectViewOnStart\": \"true\",\n    \"RunOnceActivity.ShowReadmeOnStart\": \"true\",\n    \"WebServerToolWindowFactoryState\": \"false\",\n    \"jdk.selected.JAVA_MODULE\": \"17\",\n    \"last_opened_file_path\": \"C:/Users/alexi/Documents/UM DKE/Year 3/Period 1/Computer Security/Project 1/SecureChatV2\",\n    \"node.js.detected.package.eslint\": \"true\",\n    \"node.js.detected.package.tslint\": \"true\",\n    \"node.js.selected.package.eslint\": \"(autodetect)\",\n    \"node.js.selected.package.tslint\": \"(autodetect)\",\n    \"project.structure.last.edited\": \"Libraries\",\n    \"project.structure.proportion\": \"0.15\",\n    \"project.structure.side.proportion\": \"0.2\"\n  }\n}]]></component>\n  <component name=\"RunManager\" selected=\"Application.Client\">\n    <configuration name=\"Client\" type=\"Application\" factoryName=\"Application\" temporary=\"true\" nameIsGenerated=\"true\">\n      <option name=\"MAIN_CLASS_NAME\" value=\"Client\" />\n      <module name=\"SecureChatV2\" />\n      <option name=\"PROGRAM_PARAMETERS\" value=\"client.json\" />\n      <method v=\"2\">\n        <option name=\"Make\" enabled=\"true\" />\n      </method>\n    </configuration>\n    <configuration name=\"Server\" type=\"Application\" factoryName=\"Application\" temporary=\"true\" nameIsGenerated=\"true\">\n      <option name=\"MAIN_CLASS_NAME\" value=\"Server\" />\n      <module name=\"SecureChatV2\" />\n      <method v=\"2\">\n        <option name=\"Make\" enabled=\"true\" />\n      </method>\n    </configuration>\n    <configuration default=\"true\" type=\"JetRunConfigurationType\">\n      <module name=\"SecureChatV2\" />\n      <method v=\"2\">\n        <option name=\"Make\" enabled=\"true\" />\n      </method>\n    </configuration>\n    <configuration default=\"true\" type=\"KotlinStandaloneScriptRunConfigurationType\">\n      <module name=\"SecureChatV2\" />\n      <option name=\"filePath\" />\n      <method v=\"2\">\n        <option name=\"Make\" enabled=\"true\" />\n      </method>\n    </configuration>\n    <list>\n      <item itemvalue=\"Application.Client\" />\n      <item itemvalue=\"Application.Server\" />\n    </list>\n    <recent_temporary>\n      <list>\n        <item itemvalue=\"Application.Client\" />\n        <item itemvalue=\"Application.Server\" />\n      </list>\n    </recent_temporary>\n  </component>\n  <component name=\"SpellCheckerSettings\" RuntimeDictionaries=\"0\" Folders=\"0\" CustomDictionaries=\"0\" DefaultDictionary=\"application-level\" UseSingleDictionary=\"true\" transferred=\"true\" />\n  <component name=\"TaskManager\">\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\n      <changelist id=\"56f3a841-0724-4915-84a5-723e5a82068c\" name=\"Changes\" comment=\"\" />\n      <created>1663777199187</created>\n      <option name=\"number\" value=\"Default\" />\n      <option name=\"presentableId\" value=\"Default\" />\n      <updated>1663777199187</updated>\n      <workItem from=\"1663777200402\" duration=\"32000\" />\n      <workItem from=\"1663777296108\" duration=\"967000\" />\n    </task>\n    <servers />\n  </component>\n  <component name=\"TypeScriptGeneratedFilesManager\">\n    <option name=\"version\" value=\"3\" />\n  </component>\n  <component name=\"XDebuggerManager\">\n    <breakpoint-manager>\n      <breakpoints>\n        <line-breakpoint enabled=\"true\" type=\"java-line\">\n          <url>file://$PROJECT_DIR$/src/Client.java</url>\n          <line>45</line>\n          <option name=\"timeStamp\" value=\"1\" />\n        </line-breakpoint>\n      </breakpoints>\n    </breakpoint-manager>\n  </component>\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/workspace.xml b/.idea/workspace.xml
--- a/.idea/workspace.xml	(revision e4db8dfbf383479a9745cd86c2d7da4d402cf996)
+++ b/.idea/workspace.xml	(date 1663943909969)
@@ -4,12 +4,49 @@
     <option name="autoReloadType" value="SELECTIVE" />
   </component>
   <component name="ChangeListManager">
-    <list default="true" id="56f3a841-0724-4915-84a5-723e5a82068c" name="Changes" comment="" />
+    <list default="true" id="56f3a841-0724-4915-84a5-723e5a82068c" name="Changes" comment="">
+      <change afterPath="$PROJECT_DIR$/.idea/libraries/commons_codec.xml" afterDir="false" />
+      <change afterPath="$PROJECT_DIR$/.idea/libraries/de_taimos_totp.xml" afterDir="false" />
+      <change afterPath="$PROJECT_DIR$/.idea/libraries/google_zxing_javase.xml" afterDir="false" />
+      <change afterPath="$PROJECT_DIR$/resources/users.json" afterDir="false" />
+      <change afterPath="$PROJECT_DIR$/src/Output.java" afterDir="false" />
+      <change afterPath="$PROJECT_DIR$/src/Status.java" afterDir="false" />
+      <change afterPath="$PROJECT_DIR$/src/User.java" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/.classpath" beforeDir="false" />
+      <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/.project" beforeDir="false" />
+      <change beforePath="$PROJECT_DIR$/SecureChatV2.iml" beforeDir="false" afterPath="$PROJECT_DIR$/SecureChatV2.iml" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/classes/production/SecureChatV2/Client.class" beforeDir="false" afterPath="$PROJECT_DIR$/classes/production/SecureChatV2/Client.class" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/classes/production/SecureChatV2/Server.class" beforeDir="false" afterPath="$PROJECT_DIR$/classes/production/SecureChatV2/Server.class" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/client.json" beforeDir="false" afterPath="$PROJECT_DIR$/resources/client.json" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/client2.json" beforeDir="false" afterPath="$PROJECT_DIR$/resources/client2.json" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/src/Client.java" beforeDir="false" afterPath="$PROJECT_DIR$/src/Client.java" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/src/Server.java" beforeDir="false" afterPath="$PROJECT_DIR$/src/Server.java" afterDir="false" />
+    </list>
     <option name="SHOW_DIALOG" value="false" />
     <option name="HIGHLIGHT_CONFLICTS" value="true" />
     <option name="HIGHLIGHT_NON_ACTIVE_CHANGELIST" value="false" />
     <option name="LAST_RESOLUTION" value="IGNORE" />
   </component>
+  <component name="FileTemplateManagerImpl">
+    <option name="RECENT_TEMPLATES">
+      <list>
+        <option value="Enum" />
+        <option value="Class" />
+      </list>
+    </option>
+  </component>
+  <component name="Git.Settings">
+    <option name="RECENT_GIT_ROOT_PATH" value="$PROJECT_DIR$" />
+  </component>
+  <component name="GitSEFilterConfiguration">
+    <file-type-list>
+      <filtered-out-file-type name="LOCAL_BRANCH" />
+      <filtered-out-file-type name="REMOTE_BRANCH" />
+      <filtered-out-file-type name="TAG" />
+      <filtered-out-file-type name="COMMIT_BY_MESSAGE" />
+    </file-type-list>
+  </component>
   <component name="MarkdownSettingsMigration">
     <option name="stateVersion" value="1" />
   </component>
@@ -18,31 +55,35 @@
     <option name="hideEmptyMiddlePackages" value="true" />
     <option name="showLibraryContents" value="true" />
   </component>
-  <component name="PropertiesComponent"><![CDATA[{
-  "keyToString": {
-    "Downloaded.Files.Path.Enabled": "true",
-    "Repository.Attach.Annotations": "false",
-    "Repository.Attach.JavaDocs": "false",
-    "Repository.Attach.Sources": "false",
-    "RunOnceActivity.OpenProjectViewOnStart": "true",
-    "RunOnceActivity.ShowReadmeOnStart": "true",
-    "WebServerToolWindowFactoryState": "false",
-    "jdk.selected.JAVA_MODULE": "17",
-    "last_opened_file_path": "C:/Users/alexi/Documents/UM DKE/Year 3/Period 1/Computer Security/Project 1/SecureChatV2",
-    "node.js.detected.package.eslint": "true",
-    "node.js.detected.package.tslint": "true",
-    "node.js.selected.package.eslint": "(autodetect)",
-    "node.js.selected.package.tslint": "(autodetect)",
-    "project.structure.last.edited": "Libraries",
-    "project.structure.proportion": "0.15",
-    "project.structure.side.proportion": "0.2"
-  }
-}]]></component>
+  <component name="PropertiesComponent">
+    <property name="Downloaded.Files.Path.Enabled" value="true" />
+    <property name="Repository.Attach.Annotations" value="false" />
+    <property name="Repository.Attach.JavaDocs" value="false" />
+    <property name="Repository.Attach.Sources" value="false" />
+    <property name="RunOnceActivity.OpenProjectViewOnStart" value="true" />
+    <property name="RunOnceActivity.ShowReadmeOnStart" value="true" />
+    <property name="SHARE_PROJECT_CONFIGURATION_FILES" value="true" />
+    <property name="WebServerToolWindowFactoryState" value="false" />
+    <property name="go.format.on.save.advertiser.fired" value="true" />
+    <property name="go.formatter.settings.were.checked" value="true" />
+    <property name="go.import.settings.migrated" value="true" />
+    <property name="node.js.detected.package.eslint" value="true" />
+    <property name="node.js.detected.package.tslint" value="true" />
+    <property name="node.js.selected.package.eslint" value="(autodetect)" />
+    <property name="node.js.selected.package.tslint" value="(autodetect)" />
+    <property name="project.structure.last.edited" value="Libraries" />
+    <property name="project.structure.proportion" value="0.15" />
+    <property name="project.structure.side.proportion" value="0.2" />
+  </component>
+  <component name="RecentsManager">
+    <key name="MoveFile.RECENT_KEYS">
+      <recent name="$PROJECT_DIR$/resources" />
+    </key>
+  </component>
   <component name="RunManager" selected="Application.Client">
-    <configuration name="Client" type="Application" factoryName="Application" temporary="true" nameIsGenerated="true">
+    <configuration name="Client" type="Application" factoryName="Application" singleton="false" temporary="true" nameIsGenerated="true">
       <option name="MAIN_CLASS_NAME" value="Client" />
       <module name="SecureChatV2" />
-      <option name="PROGRAM_PARAMETERS" value="client.json" />
       <method v="2">
         <option name="Make" enabled="true" />
       </method>
@@ -54,19 +95,6 @@
         <option name="Make" enabled="true" />
       </method>
     </configuration>
-    <configuration default="true" type="JetRunConfigurationType">
-      <module name="SecureChatV2" />
-      <method v="2">
-        <option name="Make" enabled="true" />
-      </method>
-    </configuration>
-    <configuration default="true" type="KotlinStandaloneScriptRunConfigurationType">
-      <module name="SecureChatV2" />
-      <option name="filePath" />
-      <method v="2">
-        <option name="Make" enabled="true" />
-      </method>
-    </configuration>
     <list>
       <item itemvalue="Application.Client" />
       <item itemvalue="Application.Server" />
@@ -88,6 +116,8 @@
       <updated>1663777199187</updated>
       <workItem from="1663777200402" duration="32000" />
       <workItem from="1663777296108" duration="967000" />
+      <workItem from="1663778779681" duration="1819000" />
+      <workItem from="1663799960070" duration="17014000" />
     </task>
     <servers />
   </component>
@@ -97,11 +127,10 @@
   <component name="XDebuggerManager">
     <breakpoint-manager>
       <breakpoints>
-        <line-breakpoint enabled="true" type="java-line">
-          <url>file://$PROJECT_DIR$/src/Client.java</url>
-          <line>45</line>
+        <breakpoint enabled="true" type="java-exception">
+          <properties class="java.lang.ClassCastException" package="java.lang" />
           <option name="timeStamp" value="1" />
-        </line-breakpoint>
+        </breakpoint>
       </breakpoints>
     </breakpoint-manager>
   </component>
Index: resources/users.json
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/resources/users.json b/resources/users.json
new file mode 100644
--- /dev/null	(date 1663939804277)
+++ b/resources/users.json	(date 1663939804277)
@@ -0,0 +1,12 @@
+[
+  {
+    "id": "Imanol",
+    "password": "Imagol",
+    "secret-key": "ORLYGCRF6DSAGE5GYNZJXBGO37DRT5I3"
+  },
+  {
+    "id": "Ruben",
+    "password": "Rugen",
+    "secret-key": "ORLYGCRF6DSAGE5GYNZJXBGO37DRT5I3"
+  }
+]
\ No newline at end of file
